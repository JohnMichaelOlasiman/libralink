{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Jan/Downloads/libra-link-student-app%20%282%29/lib/db.ts"],"sourcesContent":["import { neon } from \"@neondatabase/serverless\"\n\nexport function createClient() {\n  const connectionString = process.env.DATABASE_URL\n  if (!connectionString) {\n    throw new Error(\"DATABASE_URL environment variable is not set\")\n  }\n  return neon(connectionString)\n}\n\nexport async function withRetry<T>(fn: () => Promise<T>, retries = 3, baseDelay = 100): Promise<T> {\n  let lastError: Error | null = null\n\n  for (let attempt = 0; attempt < retries; attempt++) {\n    try {\n      return await fn()\n    } catch (error) {\n      lastError = error as Error\n      console.error(`[v0] Database attempt ${attempt + 1}/${retries} failed:`, error)\n\n      if (attempt < retries - 1) {\n        const delay = baseDelay * Math.pow(2, attempt)\n        await new Promise((resolve) => setTimeout(resolve, delay))\n      }\n    }\n  }\n\n  throw lastError\n}\n\nexport async function sql(strings: TemplateStringsArray, ...values: unknown[]) {\n  return withRetry(async () => {\n    const client = createClient()\n    return await client(strings, ...values)\n  })\n}\n\nsql.unsafe = async (query: string, values?: unknown[]) => {\n  return withRetry(async () => {\n    const client = createClient()\n    const result = await client.query(query, values || [])\n    return result\n  })\n}\n\n// Type definitions for database entities\nexport type UserRole = \"student\" | \"faculty\" | \"librarian\" | \"admin\"\nexport type UserStatus = \"active\" | \"inactive\" | \"suspended\"\nexport type BookStatus = \"available\" | \"borrowed\" | \"reserved\" | \"maintenance\"\nexport type BorrowStatus = \"pending\" | \"approved\" | \"declined\" | \"returned\" | \"overdue\"\nexport type ReservationStatus = \"active\" | \"fulfilled\" | \"expired\" | \"cancelled\"\nexport type FineStatus = \"unpaid\" | \"paid\" | \"waived\"\nexport type FineReason = \"overdue\" | \"damage\" | \"lost\" | \"other\"\n\nexport interface User {\n  id: string\n  email: string\n  password_hash: string\n  full_name: string\n  role: UserRole\n  status: UserStatus\n  university_id: string | null\n  university_name: string | null\n  department: string | null\n  phone: string | null\n  avatar_url: string | null\n  id_card_url: string | null\n  email_verified: boolean\n  last_login: Date | null\n  created_at: Date\n  updated_at: Date\n}\n\nexport interface Author {\n  id: string\n  name: string\n  bio: string | null\n  avatar_url: string | null\n  created_at: Date\n  updated_at: Date\n}\n\nexport interface Category {\n  id: string\n  name: string\n  description: string | null\n  created_at: Date\n  updated_at: Date\n}\n\nexport interface Publisher {\n  id: string\n  name: string\n  address: string | null\n  website: string | null\n  created_at: Date\n  updated_at: Date\n}\n\nexport interface Book {\n  id: string\n  title: string\n  isbn: string | null\n  description: string | null\n  cover_url: string | null\n  publisher_id: string | null\n  publication_year: number | null\n  total_copies: number\n  available_copies: number\n  rating: number\n  rating_count: number\n  status: BookStatus\n  created_at: Date\n  updated_at: Date\n}\n\nexport interface BookWithDetails extends Book {\n  authors: Author[]\n  categories: Category[]\n  publisher: Publisher | null\n}\n\nexport interface BorrowRequest {\n  id: string\n  user_id: string\n  book_id: string\n  status: BorrowStatus\n  requested_at: Date\n  approved_at: Date | null\n  approved_by: string | null\n  due_date: Date | null\n  returned_at: Date | null\n  notes: string | null\n  created_at: Date\n  updated_at: Date\n}\n\nexport interface BorrowRequestWithDetails extends BorrowRequest {\n  user: User\n  book: Book\n  approver: User | null\n}\n\nexport interface Reservation {\n  id: string\n  user_id: string\n  book_id: string\n  status: ReservationStatus\n  reserved_at: Date\n  expires_at: Date | null\n  fulfilled_at: Date | null\n  cancelled_at: Date | null\n  created_at: Date\n  updated_at: Date\n}\n\nexport interface ReservationWithDetails extends Reservation {\n  user: User\n  book: Book\n}\n\nexport interface Fine {\n  id: string\n  user_id: string\n  borrow_request_id: string | null\n  book_id: string | null\n  amount: number\n  reason: FineReason\n  status: FineStatus\n  description: string | null\n  paid_at: Date | null\n  created_by: string | null\n  created_at: Date\n  updated_at: Date\n}\n\nexport interface FineWithDetails extends Fine {\n  user: User\n  book: Book | null\n}\n\nexport interface SystemLog {\n  id: string\n  user_id: string | null\n  action: string\n  entity_type: string | null\n  entity_id: string | null\n  details: Record<string, unknown> | null\n  ip_address: string | null\n  user_agent: string | null\n  created_at: Date\n}\n\nexport interface SystemLogWithUser extends SystemLog {\n  user: User | null\n}\n\nexport interface Session {\n  id: string\n  user_id: string\n  token: string\n  expires_at: Date\n  created_at: Date\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAEO,SAAS;IACd,MAAM,mBAAmB,QAAQ,GAAG,CAAC,YAAY;IACjD,IAAI,CAAC,kBAAkB;QACrB,MAAM,IAAI,MAAM;IAClB;IACA,OAAO,IAAA,gSAAI,EAAC;AACd;AAEO,eAAe,UAAa,EAAoB,EAAE,UAAU,CAAC,EAAE,YAAY,GAAG;IACnF,IAAI,YAA0B;IAE9B,IAAK,IAAI,UAAU,GAAG,UAAU,SAAS,UAAW;QAClD,IAAI;YACF,OAAO,MAAM;QACf,EAAE,OAAO,OAAO;YACd,YAAY;YACZ,QAAQ,KAAK,CAAC,CAAC,sBAAsB,EAAE,UAAU,EAAE,CAAC,EAAE,QAAQ,QAAQ,CAAC,EAAE;YAEzE,IAAI,UAAU,UAAU,GAAG;gBACzB,MAAM,QAAQ,YAAY,KAAK,GAAG,CAAC,GAAG;gBACtC,MAAM,IAAI,QAAQ,CAAC,UAAY,WAAW,SAAS;YACrD;QACF;IACF;IAEA,MAAM;AACR;AAEO,eAAe,IAAI,OAA6B,EAAE,GAAG,MAAiB;IAC3E,OAAO,UAAU;QACf,MAAM,SAAS;QACf,OAAO,MAAM,OAAO,YAAY;IAClC;AACF;AAEA,IAAI,MAAM,GAAG,OAAO,OAAe;IACjC,OAAO,UAAU;QACf,MAAM,SAAS;QACf,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,OAAO,UAAU,EAAE;QACrD,OAAO;IACT;AACF"}},
    {"offset": {"line": 54, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Jan/Downloads/libra-link-student-app%20%282%29/lib/actions/stats-actions.ts"],"sourcesContent":["\"use server\"\n\nimport { sql } from \"@/lib/db\"\n\nexport async function getLibraryStats() {\n  try {\n    const [bookStats, borrowStats, reservationStats, fineStats] = await Promise.all([\n      sql`\n        SELECT \n          COUNT(*) as total_books,\n          SUM(total_copies) as total_copies,\n          SUM(available_copies) as available_copies,\n          SUM(total_copies - available_copies) as borrowed_copies\n        FROM books\n      `,\n      sql`\n        SELECT \n          COUNT(*) FILTER (WHERE status = 'pending') as pending,\n          COUNT(*) FILTER (WHERE status = 'approved') as active,\n          COUNT(*) FILTER (WHERE status = 'approved' AND due_date < CURRENT_DATE) as overdue,\n          COUNT(*) FILTER (WHERE status = 'returned') as returned\n        FROM borrow_requests\n      `,\n      sql`\n        SELECT \n          COUNT(*) FILTER (WHERE status = 'active') as active\n        FROM reservations\n      `,\n      sql`\n        SELECT \n          COALESCE(SUM(amount) FILTER (WHERE status = 'unpaid'), 0) as unpaid_amount\n        FROM fines\n      `,\n    ])\n\n    return {\n      totalBooks: Number(bookStats[0]?.total_books) || 0,\n      booksBorrowed: Number(borrowStats[0]?.active) || 0,\n      overdueBooks: Number(borrowStats[0]?.overdue) || 0,\n      activeReservations: Number(reservationStats[0]?.active) || 0,\n      unpaidFines: Number(fineStats[0]?.unpaid_amount) || 0,\n    }\n  } catch (error) {\n    console.error(\"Get library stats error:\", error)\n    return {\n      totalBooks: 0,\n      booksBorrowed: 0,\n      overdueBooks: 0,\n      activeReservations: 0,\n      unpaidFines: 0,\n    }\n  }\n}\n\nexport async function getAdminStats() {\n  try {\n    const [userStats, libraryStats] = await Promise.all([\n      sql`\n        SELECT \n          COUNT(*) as total_users,\n          COUNT(*) FILTER (WHERE role = 'student') as students,\n          COUNT(*) FILTER (WHERE role = 'faculty') as faculty,\n          COUNT(*) FILTER (WHERE role = 'librarian') as librarians,\n          COUNT(*) FILTER (WHERE role = 'admin') as admins\n        FROM users\n      `,\n      getLibraryStats(),\n    ])\n\n    return {\n      users: {\n        total: Number(userStats[0]?.total_users) || 0,\n        students: Number(userStats[0]?.students) || 0,\n        faculty: Number(userStats[0]?.faculty) || 0,\n        librarians: Number(userStats[0]?.librarians) || 0,\n        admins: Number(userStats[0]?.admins) || 0,\n      },\n      library: libraryStats,\n    }\n  } catch (error) {\n    console.error(\"Get admin stats error:\", error)\n    return {\n      users: { total: 0, students: 0, faculty: 0, librarians: 0, admins: 0 },\n      library: { totalBooks: 0, booksBorrowed: 0, overdueBooks: 0, activeReservations: 0, unpaidFines: 0 },\n    }\n  }\n}\n"],"names":[],"mappings":";;;;;;;AAEA;;;;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,CAAC,WAAW,aAAa,kBAAkB,UAAU,GAAG,MAAM,QAAQ,GAAG,CAAC;YAC9E,yKAAG,CAAC;;;;;;;MAOJ,CAAC;YACD,yKAAG,CAAC;;;;;;;MAOJ,CAAC;YACD,yKAAG,CAAC;;;;MAIJ,CAAC;YACD,yKAAG,CAAC;;;;MAIJ,CAAC;SACF;QAED,OAAO;YACL,YAAY,OAAO,SAAS,CAAC,EAAE,EAAE,gBAAgB;YACjD,eAAe,OAAO,WAAW,CAAC,EAAE,EAAE,WAAW;YACjD,cAAc,OAAO,WAAW,CAAC,EAAE,EAAE,YAAY;YACjD,oBAAoB,OAAO,gBAAgB,CAAC,EAAE,EAAE,WAAW;YAC3D,aAAa,OAAO,SAAS,CAAC,EAAE,EAAE,kBAAkB;QACtD;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO;YACL,YAAY;YACZ,eAAe;YACf,cAAc;YACd,oBAAoB;YACpB,aAAa;QACf;IACF;AACF;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,CAAC,WAAW,aAAa,GAAG,MAAM,QAAQ,GAAG,CAAC;YAClD,yKAAG,CAAC;;;;;;;;MAQJ,CAAC;YACD;SACD;QAED,OAAO;YACL,OAAO;gBACL,OAAO,OAAO,SAAS,CAAC,EAAE,EAAE,gBAAgB;gBAC5C,UAAU,OAAO,SAAS,CAAC,EAAE,EAAE,aAAa;gBAC5C,SAAS,OAAO,SAAS,CAAC,EAAE,EAAE,YAAY;gBAC1C,YAAY,OAAO,SAAS,CAAC,EAAE,EAAE,eAAe;gBAChD,QAAQ,OAAO,SAAS,CAAC,EAAE,EAAE,WAAW;YAC1C;YACA,SAAS;QACX;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,0BAA0B;QACxC,OAAO;YACL,OAAO;gBAAE,OAAO;gBAAG,UAAU;gBAAG,SAAS;gBAAG,YAAY;gBAAG,QAAQ;YAAE;YACrE,SAAS;gBAAE,YAAY;gBAAG,eAAe;gBAAG,cAAc;gBAAG,oBAAoB;gBAAG,aAAa;YAAE;QACrG;IACF;AACF;;;IAlFsB;IAkDA;;AAlDA,uaAAA;AAkDA,uaAAA"}},
    {"offset": {"line": 174, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Jan/Downloads/libra-link-student-app%20%282%29/lib/auth.ts"],"sourcesContent":["import { sql, type User, type UserRole } from \"./db\"\nimport { cookies } from \"next/headers\"\nimport crypto from \"crypto\"\n\n// Simple password hashing (in production, use bcrypt)\nfunction hashPassword(password: string): string {\n  return crypto.createHash(\"sha256\").update(password).digest(\"hex\")\n}\n\nfunction verifyPassword(password: string, hash: string): boolean {\n  return hashPassword(password) === hash\n}\n\n// Generate a secure random token\nfunction generateToken(): string {\n  return crypto.randomBytes(32).toString(\"hex\")\n}\n\n// Session duration (7 days)\nconst SESSION_DURATION = 7 * 24 * 60 * 60 * 1000\n\nexport async function signUp(\n  email: string,\n  password: string,\n  fullName: string,\n  universityId?: string,\n  universityName?: string,\n  idCardUrl?: string,\n): Promise<{ user: User | null; error: string | null }> {\n  try {\n    // Check if email already exists\n    const existingUser = await sql`\n      SELECT id FROM users WHERE email = ${email}\n    `\n    if (existingUser.length > 0) {\n      return { user: null, error: \"Email already registered\" }\n    }\n\n    // Check if university ID already exists\n    if (universityId) {\n      const existingId = await sql`\n        SELECT id FROM users WHERE university_id = ${universityId}\n      `\n      if (existingId.length > 0) {\n        return { user: null, error: \"University ID already registered\" }\n      }\n    }\n\n    const passwordHash = hashPassword(password)\n\n    const result = await sql`\n      INSERT INTO users (email, password_hash, full_name, university_id, university_name, id_card_url)\n      VALUES (${email}, ${passwordHash}, ${fullName}, ${universityId || null}, ${universityName || null}, ${idCardUrl || null})\n      RETURNING *\n    `\n\n    return { user: result[0] as User, error: null }\n  } catch (error) {\n    console.error(\"Sign up error:\", error)\n    return { user: null, error: \"Failed to create account\" }\n  }\n}\n\nexport async function signIn(\n  email: string,\n  password: string,\n): Promise<{ user: User | null; token: string | null; error: string | null }> {\n  try {\n    const result = await sql`\n      SELECT * FROM users WHERE email = ${email}\n    `\n\n    if (result.length === 0) {\n      return { user: null, token: null, error: \"Invalid email or password\" }\n    }\n\n    const user = result[0] as User\n\n    if (user.status !== \"active\") {\n      return { user: null, token: null, error: \"Account is not active\" }\n    }\n\n    if (!verifyPassword(password, user.password_hash)) {\n      return { user: null, token: null, error: \"Invalid email or password\" }\n    }\n\n    // Create session\n    const token = generateToken()\n    const expiresAt = new Date(Date.now() + SESSION_DURATION)\n\n    await sql`\n      INSERT INTO sessions (user_id, token, expires_at)\n      VALUES (${user.id}, ${token}, ${expiresAt})\n    `\n\n    // Update last login\n    await sql`\n      UPDATE users SET last_login = NOW() WHERE id = ${user.id}\n    `\n\n    // Log the login\n    await sql`\n      INSERT INTO system_logs (user_id, action, entity_type, entity_id, details)\n      VALUES (${user.id}, 'user_login', 'user', ${user.id}, '{\"method\": \"password\"}')\n    `\n\n    return { user, token, error: null }\n  } catch (error) {\n    console.error(\"Sign in error:\", error)\n    return { user: null, token: null, error: \"Failed to sign in\" }\n  }\n}\n\nexport async function signOut(token: string): Promise<void> {\n  try {\n    await sql`\n      DELETE FROM sessions WHERE token = ${token}\n    `\n  } catch (error) {\n    console.error(\"Sign out error:\", error)\n  }\n}\n\nexport async function getSession(): Promise<{ user: User | null; token: string | null }> {\n  try {\n    const cookieStore = await cookies()\n    const token = cookieStore.get(\"session_token\")?.value\n\n    if (!token) {\n      return { user: null, token: null }\n    }\n\n    const result = await sql`\n      SELECT u.* FROM users u\n      INNER JOIN sessions s ON u.id = s.user_id\n      WHERE s.token = ${token} AND s.expires_at > NOW()\n    `\n\n    if (result.length === 0) {\n      return { user: null, token: null }\n    }\n\n    return { user: result[0] as User, token }\n  } catch (error) {\n    console.error(\"Get session error:\", error)\n    return { user: null, token: null }\n  }\n}\n\nexport async function getUserById(id: string): Promise<User | null> {\n  try {\n    const result = await sql`\n      SELECT * FROM users WHERE id = ${id}\n    `\n    return result.length > 0 ? (result[0] as User) : null\n  } catch (error) {\n    console.error(\"Get user error:\", error)\n    return null\n  }\n}\n\nexport async function requireAuth(): Promise<User> {\n  const { user } = await getSession()\n  if (!user) {\n    throw new Error(\"Unauthorized\")\n  }\n  return user\n}\n\nexport async function requireRole(roles: UserRole[]): Promise<User> {\n  const user = await requireAuth()\n  if (!roles.includes(user.role)) {\n    throw new Error(\"Forbidden\")\n  }\n  return user\n}\n\nexport function isAdmin(user: User): boolean {\n  return user.role === \"admin\"\n}\n\nexport function isLibrarian(user: User): boolean {\n  return user.role === \"librarian\" || user.role === \"admin\"\n}\n\nexport function isStaff(user: User): boolean {\n  return user.role === \"librarian\" || user.role === \"admin\"\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 394, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Jan/Downloads/libra-link-student-app%20%282%29/lib/actions/auth-actions.ts"],"sourcesContent":["\"use server\"\n\nimport { signIn, signUp, signOut, getSession } from \"@/lib/auth\"\nimport { cookies } from \"next/headers\"\nimport { redirect } from \"next/navigation\"\n\nexport async function loginAction(formData: FormData) {\n  const email = formData.get(\"email\") as string\n  const password = formData.get(\"password\") as string\n\n  const { user, token, error } = await signIn(email, password)\n\n  if (error || !token) {\n    return { error: error || \"Failed to sign in\" }\n  }\n\n  const cookieStore = await cookies()\n  cookieStore.set(\"session_token\", token, {\n    httpOnly: true,\n    secure: process.env.NODE_ENV === \"production\",\n    sameSite: \"lax\",\n    maxAge: 7 * 24 * 60 * 60, // 7 days\n    path: \"/\",\n  })\n\n  // Redirect based on role\n  if (user?.role === \"admin\") {\n    redirect(\"/admin\")\n  } else if (user?.role === \"librarian\") {\n    redirect(\"/librarian\")\n  } else {\n    redirect(\"/dashboard\")\n  }\n}\n\nexport async function registerAction(formData: FormData) {\n  const email = formData.get(\"email\") as string\n  const password = formData.get(\"password\") as string\n  const fullName = formData.get(\"fullName\") as string\n  const universityId = formData.get(\"universityId\") as string\n  const universityName = formData.get(\"universityName\") as string\n\n  const { user, error } = await signUp(email, password, fullName, universityId, universityName)\n\n  if (error || !user) {\n    return { error: error || \"Failed to create account\" }\n  }\n\n  // Auto sign in after registration\n  const { token, error: signInError } = await signIn(email, password)\n\n  if (signInError || !token) {\n    return { error: \"Account created. Please sign in.\" }\n  }\n\n  const cookieStore = await cookies()\n  cookieStore.set(\"session_token\", token, {\n    httpOnly: true,\n    secure: process.env.NODE_ENV === \"production\",\n    sameSite: \"lax\",\n    maxAge: 7 * 24 * 60 * 60,\n    path: \"/\",\n  })\n\n  redirect(\"/dashboard\")\n}\n\nexport async function logoutAction() {\n  const cookieStore = await cookies()\n  const token = cookieStore.get(\"session_token\")?.value\n\n  if (token) {\n    await signOut(token)\n    cookieStore.delete(\"session_token\")\n  }\n\n  redirect(\"/login\")\n}\n\nexport async function getCurrentUser() {\n  const { user } = await getSession()\n  return user\n}\n"],"names":[],"mappings":";;;;;;;;;;;AAEA;AACA;AACA;AAAA;;;;;;AAEO,eAAe,YAAY,QAAkB;IAClD,MAAM,QAAQ,SAAS,GAAG,CAAC;IAC3B,MAAM,WAAW,SAAS,GAAG,CAAC;IAE9B,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,KAAK,EAAE,GAAG,MAAM,IAAA,8KAAM,EAAC,OAAO;IAEnD,IAAI,SAAS,CAAC,OAAO;QACnB,OAAO;YAAE,OAAO,SAAS;QAAoB;IAC/C;IAEA,MAAM,cAAc,MAAM,IAAA,kUAAO;IACjC,YAAY,GAAG,CAAC,iBAAiB,OAAO;QACtC,UAAU;QACV,QAAQ,oDAAyB;QACjC,UAAU;QACV,QAAQ,IAAI,KAAK,KAAK;QACtB,MAAM;IACR;IAEA,yBAAyB;IACzB,IAAI,MAAM,SAAS,SAAS;QAC1B,IAAA,yXAAQ,EAAC;IACX,OAAO,IAAI,MAAM,SAAS,aAAa;QACrC,IAAA,yXAAQ,EAAC;IACX,OAAO;QACL,IAAA,yXAAQ,EAAC;IACX;AACF;AAEO,eAAe,eAAe,QAAkB;IACrD,MAAM,QAAQ,SAAS,GAAG,CAAC;IAC3B,MAAM,WAAW,SAAS,GAAG,CAAC;IAC9B,MAAM,WAAW,SAAS,GAAG,CAAC;IAC9B,MAAM,eAAe,SAAS,GAAG,CAAC;IAClC,MAAM,iBAAiB,SAAS,GAAG,CAAC;IAEpC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,IAAA,8KAAM,EAAC,OAAO,UAAU,UAAU,cAAc;IAE9E,IAAI,SAAS,CAAC,MAAM;QAClB,OAAO;YAAE,OAAO,SAAS;QAA2B;IACtD;IAEA,kCAAkC;IAClC,MAAM,EAAE,KAAK,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,IAAA,8KAAM,EAAC,OAAO;IAE1D,IAAI,eAAe,CAAC,OAAO;QACzB,OAAO;YAAE,OAAO;QAAmC;IACrD;IAEA,MAAM,cAAc,MAAM,IAAA,kUAAO;IACjC,YAAY,GAAG,CAAC,iBAAiB,OAAO;QACtC,UAAU;QACV,QAAQ,oDAAyB;QACjC,UAAU;QACV,QAAQ,IAAI,KAAK,KAAK;QACtB,MAAM;IACR;IAEA,IAAA,yXAAQ,EAAC;AACX;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,kUAAO;IACjC,MAAM,QAAQ,YAAY,GAAG,CAAC,kBAAkB;IAEhD,IAAI,OAAO;QACT,MAAM,IAAA,+KAAO,EAAC;QACd,YAAY,MAAM,CAAC;IACrB;IAEA,IAAA,yXAAQ,EAAC;AACX;AAEO,eAAe;IACpB,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,IAAA,kLAAU;IACjC,OAAO;AACT;;;IA5EsB;IA6BA;IAgCA;IAYA;;AAzEA,uaAAA;AA6BA,uaAAA;AAgCA,uaAAA;AAYA,uaAAA"}},
    {"offset": {"line": 497, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Jan/Downloads/libra-link-student-app%20%282%29/.next-internal/server/app/librarian/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {getAdminStats as '0028d2e8116a902099c141ab64b47e14539d536cd2'} from 'ACTIONS_MODULE0'\nexport {getLibraryStats as '00feb4b4eec4c41d1af30a2d852937a7cbbc78e396'} from 'ACTIONS_MODULE0'\nexport {logoutAction as '0039632f10247d81b5a312638e6c83268c5cc2ead4'} from 'ACTIONS_MODULE1'\n"],"names":[],"mappings":";AAAA;AAEA"}}]
}